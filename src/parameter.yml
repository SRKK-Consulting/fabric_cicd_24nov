# parameter.yml
# Fabric CI/CD Configuration for PPE and PROD

# ---------------------------------------------------------
# Find & Replace Rules
# ---------------------------------------------------------
find_replace:

  # -------------------------------------------------------
  # 1. NOTEBOOK REBINDING
  # -------------------------------------------------------
  # Updates the "Default Lakehouse" pinned in the Notebook UI.
  # Matches the specific JSON format in the .ipynb definition.
  - find_value: \#\s*META\s+"default_lakehouse":\s*"([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})"
    is_regex: "true"
    item_type: "Notebook"
    replace_value:
      # Dynamically finds the ID of the 'Sales_Lakehouse' deployed in the current environment
      PPE: "$items.Lakehouse.Sales_Lakehouse.$id"
      PROD: "$items.Lakehouse.Sales_Lakehouse.$id"

  # Updates the Workspace ID associated with that Lakehouse.
  - find_value: \#\s*META\s+"default_lakehouse_workspace_id":\s*"([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})"
    is_regex: "true"
    item_type: "Notebook"
    replace_value:
      # Dynamically injects the ID of the target workspace (PPE or PROD)
      PPE: "$workspace.$id"
      PROD: "$workspace.$id"